<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gen Z URL Translator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }
        
        .spinner {
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-message {
            font-size: 14px;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            margin-top: 12px;
            transition: all 0.3s ease;
        }
        
        .status-loading {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }
        
        .status-success {
            background: #dcfce7;
            color: #15803d;
            border: 1px solid #bbf7d0;
        }
        
        .status-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .result-container {
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: #f9fafb;
        }
        
        .result-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }
        
        .result-content {
            padding: 20px;
            line-height: 1.6;
            color: #374151;
        }
        
        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .news-article-content {
            font-family: Georgia, serif;
            line-height: 1.7;
        }
        
        .news-article-content h1,
        .news-article-content h2,
        .news-article-content h3 {
            color: #1f2937;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 4px;
        }

        .typeahead-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .typeahead-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .typeahead-item:hover, .typeahead-item.highlighted {
            background-color: #f8fafc;
        }

        .typeahead-item:last-child {
            border-bottom: none;
        }

        .url-suggestion {
            font-family: 'Inter', monospace;
            color: #6b7280;
        }

        .url-suggestion .domain {
            color: #3b82f6;
            font-weight: 500;
        }

        .url-fix-notice {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-2xl">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <span class="text-5xl">üì±</span>
                    <h1 class="text-4xl font-bold text-white">Gen Z URL Translator</h1>
                    <span class="text-5xl">üí¨</span>
                </div>
                <p class="text-white/80 text-lg">Transform any website into Gen Z slang ‚Ä¢ No cap! üî•</p>
            </div>

            <!-- Main Input Card -->
            <div class="card p-8 mb-6">
                <div class="mb-6">
                    <label for="urlInput" class="block text-gray-700 font-semibold mb-3">
                        Enter Website URL
                    </label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-lg">üåê</span>
                        <input
                            type="url"
                            id="urlInput"
                            placeholder="Type a website URL... (e.g., bbc.com, reddit.com)"
                            class="w-full pl-14 pr-4 py-4 rounded-lg border-2 border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all text-lg"
                            autocomplete="off"
                        />
                        <div id="typeaheadDropdown" class="typeahead-dropdown hidden"></div>
                    </div>

                    <!-- URL Fix Notice -->
                    <div id="urlFixNotice" class="hidden url-fix-notice">
                        <span>‚ö°</span>
                        <span id="urlFixText"></span>
                    </div>
                    
                    <!-- Status Message -->
                    <div id="statusMessage" class="hidden status-message">
                        <div class="flex items-center gap-2">
                            <div id="statusSpinner" class="hidden spinner"></div>
                            <span id="statusText"></span>
                        </div>
                    </div>
                </div>

                <button
                    id="translateBtn"
                    onclick="handleTranslate()"
                    class="w-full py-4 btn-primary text-white font-bold rounded-lg text-lg"
                >
                    <span id="btnText">Translate to Gen Z üî•</span>
                    <div id="btnLoader" class="hidden flex items-center justify-center gap-3">
                        <div class="spinner"></div>
                        <span id="loadingText">Translating...</span>
                    </div>
                </button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <!-- Original Content -->
                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        üìÑ Original Content
                        <button onclick="copyToClipboard('originalContent')" class="ml-auto px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-md text-sm transition-colors">
                            üìã Copy
                        </button>
                    </h3>
                    <div class="result-container">
                        <div class="result-content">
                            <div id="originalContent" class="whitespace-pre-wrap"></div>
                        </div>
                    </div>
                </div>

                <!-- Gen Z Translation -->
                <div class="card p-6 mb-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        üî• Gen Z Translation
                    </h3>
                    <div class="result-container">
                        <div class="result-header">
                            <span>üí¨ Gen Z Translator</span>
                            <button onclick="copyToClipboard('translatedContent')" class="copy-btn">
                                üìã Copy
                            </button>
                        </div>
                        <div class="result-content">
                            <div id="translatedContent" class="whitespace-pre-wrap font-medium"></div>
                        </div>
                    </div>
                </div>

                <!-- Try Another Button -->
                <div class="text-center">
                    <button
                        onclick="resetTranslator()"
                        class="px-8 py-3 bg-white/20 backdrop-blur-sm border border-white/30 text-white font-semibold rounded-lg hover:bg-white/30 transition-all"
                    >
                        Translate Another URL ‚ú®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Gen Z slang dictionary
        const genZSlang = {
            // Basic replacements
            'very': 'hella',
            'really': 'lowkey',
            'actually': 'literally',
            'honestly': 'no cap',
            'definitely': 'for sure',
            'absolutely': 'periodt',
            'probably': 'prolly',
            'because': 'cuz',
            'though': 'tho',
            'okay': 'bet',
            'ok': 'bet',
            'cool': 'fire',
            'awesome': 'bussin',
            'amazing': 'slaps',
            'good': 'valid',
            'bad': 'trash',
            'terrible': 'mid',
            'stupid': 'goofy',
            'crazy': 'unhinged',
            'weird': 'sus',
            'suspicious': 'sus',
            'embarrassing': 'cringe',
            'angry': 'pressed',
            'upset': 'salty',
            'excited': 'hyped',
            'tired': 'drained',
            'confused': 'lost',
            'understand': 'get it',
            'leaving': 'dipping',
            'going': 'bout to',
            'talking': 'spitting',
            'lying': 'capping',
            'truth': 'facts',
            'money': 'bag',
            'food': 'eats',
            'house': 'crib',
            'car': 'whip',
            'phone': 'device',
            'computer': 'setup',
            'internet': 'the web',
            'fake': 'cap',
            'real': 'no cap',
            'for real': 'fr fr',
            'nevermind': 'nvm',
            'whatever': 'whatevs',
            'something': 'sum',
            'nothing': 'nun',
            'everyone': 'y\'all',
            'relationship': 'situationship',
            'boyfriend': 'bae',
            'girlfriend': 'bae',
            'friends': 'squad',
            'parents': 'folks',
            'family': 'fam',
            'ridiculous': 'unreal',
            'hilarious': 'dead',
            'funny': 'sending me',
            'perfect': 'chef\'s kiss',
            'excellent': 'immaculate',
            'wrong': 'not it',
            'correct': 'that\'s it',
            'drama': 'mess',
            'party': 'function',
            'music': 'bops',
            'dance': 'vibe',
            'style': 'drip',
            'outfit': 'fit',
            'attractive': 'fine',
            'ugly': 'not it',
            'beautiful': 'gorgeous',
            'smart': 'big brain',
            'dumb': 'smooth brain',
            'information': 'tea',
            'website': 'site',
            'content': 'stuff'
        };

        // Gen Z phrases to sprinkle in
        const genZPhrases = [
            'no cap',
            'fr fr',
            'periodt',
            'and I oop',
            'that hits different',
            'it\'s giving main character',
            'slay queen',
            'we love to see it',
            'this ain\'t it chief',
            'big mood',
            'I\'m deceased',
            'not me...',
            'the way I...',
            'bestie...',
            'respectfully',
            'I said what I said'
        ];

        function translateToGenZ(text) {
            let translated = text;
            
            // Apply slang replacements (case insensitive)
            Object.entries(genZSlang).forEach(([original, slang]) => {
                const regex = new RegExp(`\\b${original}\\b`, 'gi');
                translated = translated.replace(regex, slang);
            });

            // Add Gen Z flair randomly
            const sentences = translated.split(/[.!?]+/);
            const enhancedSentences = sentences.map((sentence, index) => {
                if (!sentence.trim()) return sentence;
                
                // Randomly add Gen Z phrases
                if (Math.random() < 0.3) {
                    const randomPhrase = genZPhrases[Math.floor(Math.random() * genZPhrases.length)];
                    return `${sentence.trim()}, ${randomPhrase}`;
                }
                
                // Add emphasis randomly
                if (Math.random() < 0.2) {
                    const emojis = ['üíØ', 'üî•', '‚ú®', 'üíÖ', 'üëë', 'üö´üß¢'];
                    const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
                    return `${sentence.trim()} ${randomEmoji}`;
                }
                
                return sentence.trim();
            });

            return enhancedSentences.join('. ').replace(/\.\s*\./g, '.');
        }

        async function fetchUrlContent(url) {
            const BACKEND_URL = 'https://genz-translator-api.azurewebsites.net';

            try {
                const response = await fetch(`${BACKEND_URL}/extract`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        enableBrowserEmulation: true,
                        followLinks: true,
                        maxDepth: 2,
                        maxLinksPerPage: 5
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => null);
                    throw new Error(errorData?.error || `HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to extract content');
                }

                return {
                    title: data.data.title || 'No title found',
                    body: data.data.content,
                    url: data.data.url,
                    metadata: data.data.metadata,
                    linkedContent: data.data.linkedContent || []
                };

            } catch (error) {
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    throw new Error('Cannot connect to backend service. Please check your connection.');
                } else if (error.message.includes('timeout') || error.message.includes('408')) {
                    throw new Error('Website took too long to respond. Try a different URL.');
                } else if (error.message.includes('404')) {
                    throw new Error('Page not found. Please check the URL.');
                } else if (error.message.includes('403') || error.message.includes('401')) {
                    throw new Error('Access denied. The website may block automated requests.');
                }

                throw new Error(error.message);
            }
        }

        // Popular domains for typeahead suggestions
        const popularDomains = [
            { domain: 'bbc.com', name: 'BBC News', icon: 'üì∞' },
            { domain: 'cnn.com', name: 'CNN', icon: 'üì∫' },
            { domain: 'reddit.com', name: 'Reddit', icon: 'ü§ñ' },
            { domain: 'twitter.com', name: 'Twitter', icon: 'üê¶' },
            { domain: 'youtube.com', name: 'YouTube', icon: 'üìπ' },
            { domain: 'github.com', name: 'GitHub', icon: 'üíª' },
            { domain: 'stackoverflow.com', name: 'Stack Overflow', icon: 'ü§ì' },
            { domain: 'medium.com', name: 'Medium', icon: '‚úçÔ∏è' },
            { domain: 'wikipedia.org', name: 'Wikipedia', icon: 'üìö' },
            { domain: 'nytimes.com', name: 'New York Times', icon: 'üì∞' },
            { domain: 'washingtonpost.com', name: 'Washington Post', icon: 'üì∞' },
            { domain: 'theguardian.com', name: 'The Guardian', icon: 'üì∞' },
            { domain: 'techcrunch.com', name: 'TechCrunch', icon: 'üíº' },
            { domain: 'verge.com', name: 'The Verge', icon: 'üîÆ' },
            { domain: 'wired.com', name: 'WIRED', icon: '‚ö°' },
            { domain: 'arstechnica.com', name: 'Ars Technica', icon: 'üî¨' }
        ];

        let currentHighlightIndex = -1;
        let typeaheadVisible = false;

        function smartValidateUrl(input) {
            let url = input.trim();
            let corrected = false;
            let originalUrl = url;

            // If empty, return invalid
            if (!url) return { valid: false, url, corrected: false };

            // If it looks like a domain without protocol, add https://
            if (!url.match(/^https?:\/\//i)) {
                // Check if it looks like a domain (contains a dot and valid characters)
                if (url.match(/^[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?)*$/)) {
                    url = 'https://' + url;
                    corrected = true;
                }
            }

            // Try to validate the URL
            try {
                const urlObj = new URL(url);
                if (['http:', 'https:'].includes(urlObj.protocol)) {
                    return {
                        valid: true,
                        url,
                        corrected,
                        originalUrl,
                        fixedUrl: corrected ? url : null
                    };
                }
            } catch {
                // If URL is still invalid, try some common fixes
                if (!url.includes('.')) {
                    // Try adding .com
                    const withCom = 'https://' + originalUrl + '.com';
                    try {
                        new URL(withCom);
                        return {
                            valid: true,
                            url: withCom,
                            corrected: true,
                            originalUrl,
                            fixedUrl: withCom
                        };
                    } catch {}
                }
            }

            return { valid: false, url: originalUrl, corrected: false };
        }

        function showTypeahead(input) {
            const dropdown = document.getElementById('typeaheadDropdown');
            const query = input.toLowerCase();

            if (!query) {
                hideTypeahead();
                return;
            }

            // Filter domains based on input
            const matches = popularDomains.filter(item =>
                item.domain.toLowerCase().includes(query) ||
                item.name.toLowerCase().includes(query)
            ).slice(0, 6);

            if (matches.length === 0) {
                hideTypeahead();
                return;
            }

            // Generate dropdown HTML
            const html = matches.map((item, index) => `
                <div class="typeahead-item" data-index="${index}" data-url="https://${item.domain}">
                    <span class="text-xl">${item.icon}</span>
                    <div class="url-suggestion">
                        <div class="domain">${item.domain}</div>
                        <div class="text-sm text-gray-500">${item.name}</div>
                    </div>
                </div>
            `).join('');

            dropdown.innerHTML = html;
            dropdown.classList.remove('hidden');
            typeaheadVisible = true;
            currentHighlightIndex = -1;

            // Add click listeners
            dropdown.querySelectorAll('.typeahead-item').forEach(item => {
                item.addEventListener('click', () => {
                    const url = item.dataset.url;
                    document.getElementById('urlInput').value = url;
                    hideTypeahead();
                    hideUrlFixNotice();
                });
            });
        }

        function hideTypeahead() {
            document.getElementById('typeaheadDropdown').classList.add('hidden');
            typeaheadVisible = false;
            currentHighlightIndex = -1;
        }

        function highlightTypeaheadItem(index) {
            const items = document.querySelectorAll('.typeahead-item');
            items.forEach((item, i) => {
                item.classList.toggle('highlighted', i === index);
            });
        }

        function selectHighlightedItem() {
            const highlightedItem = document.querySelector('.typeahead-item.highlighted');
            if (highlightedItem) {
                const url = highlightedItem.dataset.url;
                document.getElementById('urlInput').value = url;
                hideTypeahead();
                hideUrlFixNotice();
                return true;
            }
            return false;
        }

        function showUrlFixNotice(originalUrl, fixedUrl) {
            const notice = document.getElementById('urlFixNotice');
            const text = document.getElementById('urlFixText');
            text.textContent = `Auto-corrected "${originalUrl}" to "${fixedUrl}"`;
            notice.classList.remove('hidden');
        }

        function hideUrlFixNotice() {
            document.getElementById('urlFixNotice').classList.add('hidden');
        }

        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('statusMessage');
            const statusText = document.getElementById('statusText');
            const statusSpinner = document.getElementById('statusSpinner');
            
            statusText.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            
            if (type === 'loading') {
                statusSpinner.classList.remove('hidden');
            } else {
                statusSpinner.classList.add('hidden');
            }
            
            statusDiv.classList.remove('hidden');
        }

        function hideStatus() {
            document.getElementById('statusMessage').classList.add('hidden');
        }

        function setLoading(loading) {
            const btn = document.getElementById('translateBtn');
            const btnText = document.getElementById('btnText');
            const btnLoader = document.getElementById('btnLoader');
            const loadingText = document.getElementById('loadingText');
            
            btn.disabled = loading;
            
            if (loading) {
                btnText.classList.add('hidden');
                btnLoader.classList.remove('hidden');
            } else {
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }

        function showResults() {
            document.getElementById('resultsSection').classList.remove('hidden');
        }

        function hideResults() {
            document.getElementById('resultsSection').classList.add('hidden');
        }

        function resetTranslator() {
            document.getElementById('urlInput').value = '';
            hideStatus();
            hideResults();
        }

        async function handleTranslate() {
            const urlInput = document.getElementById('urlInput');
            const inputUrl = urlInput.value.trim();

            // Smart validate URL
            const validation = smartValidateUrl(inputUrl);

            if (!validation.valid) {
                showStatus('Please enter a valid URL (e.g., bbc.com, reddit.com)', 'error');
                return;
            }

            // Show auto-correction notice if URL was fixed
            if (validation.corrected) {
                showUrlFixNotice(validation.originalUrl, validation.url);
                urlInput.value = validation.url; // Update input with corrected URL
            }

            const url = validation.url;

            setLoading(true);
            hideResults();
            
            try {
                showStatus('Connecting to backend...', 'loading');
                
                const urlContent = await fetchUrlContent(url);
                
                document.getElementById('loadingText').textContent = 'Translating content...';
                showStatus('Translating to Gen Z...', 'loading');
                
                // Combine title, body, and linked content
                let fullContent = `${urlContent.title}\n\n${urlContent.body}`;

                // Add linked content if available
                if (urlContent.linkedContent && urlContent.linkedContent.length > 0) {
                    fullContent += '\n\n=== Related Content ===\n\n';
                    urlContent.linkedContent.forEach((link, index) => {
                        fullContent += `${index + 1}. ${link.title}\n${link.content}\n\n`;
                    });
                }

                const translated = translateToGenZ(fullContent);

                // Display results with rich formatting
                displayRichContent('originalContent', fullContent, urlContent);
                displayRichContent('translatedContent', translated, urlContent);
                
                showStatus('Translation complete! üî•', 'success');
                showResults();
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    hideStatus();
                }, 3000);
                
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
                console.error('Translation error:', error);
            } finally {
                setLoading(false);
            }
        }

        function displayRichContent(elementId, content, urlContent) {
            const element = document.getElementById(elementId);

            // Enhanced content formatting with rich display
            let htmlContent = content
                // Convert section headers (=== Text ===)
                .replace(/\n=== (.+) ===\n/g, '<div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white p-3 rounded-lg mt-6 mb-4 font-semibold text-center">üîó $1</div>')
                // Convert numbered headings (= Text =)
                .replace(/\n= (.+) =\n/g, '<h2 class="text-xl font-bold text-gray-800 mt-6 mb-3 border-b-2 border-purple-200 pb-2">üìÑ $1</h2>')
                // Convert regular headings
                .replace(/\n([A-Z][^\n]*:)\n/g, '<h3 class="text-lg font-semibold text-gray-700 mt-4 mb-2">$1</h3>')
                // Convert numbered lists (1. 2. 3.)
                .replace(/\n(\d+)\. (.+)/g, '<div class="flex items-start mb-2"><span class="bg-purple-100 text-purple-700 rounded-full w-6 h-6 flex items-center justify-center text-sm font-semibold mr-3 mt-0.5">$1</span><span class="leading-relaxed">$2</span></div>')
                // Convert bullet points
                .replace(/\n‚Ä¢ (.+)/g, '<li class="ml-4 mb-2 leading-relaxed">$1</li>')
                // Convert paragraphs
                .replace(/\n\n([^<‚Ä¢\d\n=][^\n]*(?:\n[^<‚Ä¢\d\n=][^\n]*)*)/g, '<p class="mb-4 leading-relaxed text-gray-700">$1</p>')
                // Convert line breaks
                .replace(/\n/g, '<br>');

            // Wrap consecutive list items in proper ul tags
            htmlContent = htmlContent.replace(/(<li[^>]*>.*?<\/li>(?:\s*<li[^>]*>.*?<\/li>)*)/gs, '<ul class="list-disc ml-6 mb-4 space-y-1">$1</ul>');

            // Add metadata banner if available
            let metadataHtml = '';
            if (urlContent.metadata) {
                const metadata = urlContent.metadata;
                metadataHtml = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">üåê</span>
                            <span class="font-semibold text-blue-800">Source Information</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-blue-700">
                            ${metadata.siteName ? `<div><strong>Site:</strong> ${metadata.siteName}</div>` : ''}
                            ${metadata.author ? `<div><strong>Author:</strong> ${metadata.author}</div>` : ''}
                            ${metadata.publishDate ? `<div><strong>Published:</strong> ${new Date(metadata.publishDate).toLocaleDateString()}</div>` : ''}
                            ${metadata.wordCount ? `<div><strong>Word Count:</strong> ${metadata.wordCount.toLocaleString()}</div>` : ''}
                        </div>
                        ${urlContent.linkedContent && urlContent.linkedContent.length > 0 ?
                            `<div class="mt-2 text-sm text-blue-600">üìé Includes ${urlContent.linkedContent.length} related link${urlContent.linkedContent.length > 1 ? 's' : ''}</div>` : ''
                        }
                    </div>
                `;
            }

            element.innerHTML = metadataHtml + htmlContent;

            // Add special styling for news articles
            if (urlContent.metadata?.isNewsArticle) {
                element.classList.add('news-article-content');
            }
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                showStatus('Copied to clipboard! üìã', 'success');
                setTimeout(hideStatus, 2000);
            }).catch(() => {
                showStatus('Failed to copy to clipboard', 'error');
                setTimeout(hideStatus, 2000);
            });
        }

        // Enhanced input event listeners
        const urlInput = document.getElementById('urlInput');

        // Input event for typeahead
        urlInput.addEventListener('input', function(e) {
            const value = e.target.value;
            showTypeahead(value);
            hideUrlFixNotice(); // Hide any previous fix notices when typing
        });

        // Keyboard navigation for typeahead
        urlInput.addEventListener('keydown', function(e) {
            if (typeaheadVisible) {
                const items = document.querySelectorAll('.typeahead-item');
                const maxIndex = items.length - 1;

                switch (e.key) {
                    case 'ArrowDown':
                        e.preventDefault();
                        currentHighlightIndex = Math.min(currentHighlightIndex + 1, maxIndex);
                        highlightTypeaheadItem(currentHighlightIndex);
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        currentHighlightIndex = Math.max(currentHighlightIndex - 1, -1);
                        highlightTypeaheadItem(currentHighlightIndex);
                        break;
                    case 'Enter':
                        e.preventDefault();
                        if (selectHighlightedItem()) {
                            return; // URL was selected from typeahead
                        }
                        // Fall through to normal enter handling
                        handleTranslate();
                        break;
                    case 'Escape':
                        hideTypeahead();
                        break;
                    case 'Tab':
                        if (currentHighlightIndex >= 0) {
                            e.preventDefault();
                            selectHighlightedItem();
                        } else {
                            hideTypeahead();
                        }
                        break;
                }
            } else if (e.key === 'Enter') {
                handleTranslate();
            }
        });

        // Hide typeahead when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.relative')) {
                hideTypeahead();
            }
        });

        // Blur event to hide typeahead after a short delay
        urlInput.addEventListener('blur', function() {
            setTimeout(() => {
                if (!document.querySelector('.typeahead-item:hover')) {
                    hideTypeahead();
                }
            }, 150);
        });

        // Auto-hide error messages after 5 seconds
        let errorTimeout;
        const originalShowStatus = showStatus;
        showStatus = function(message, type = 'loading') {
            clearTimeout(errorTimeout);
            originalShowStatus(message, type);
            
            if (type === 'error') {
                errorTimeout = setTimeout(hideStatus, 5000);
            }
        };
    </script>
</body>
</html>